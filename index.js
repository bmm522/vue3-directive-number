const listeners=new Map,selections=new Map,prevCommaCount=new Map;class VueNumber{install(app){app.directive("number",{mounted:(el,binding)=>{validBinding(binding);var keyListener=e=>keyEvent(e,binding),inputListener=e=>inputEvent(e,binding),blurListener=e=>blurEvent(e,binding);if(listeners.set(el,{key:keyListener,input:inputListener,blur:blurListener}),prevCommaCount.set(el,0),el.addEventListener("keydown",keyListener),el.addEventListener("input",inputListener),["INPUT","TEXTAREA"].includes(el.tagName))el.addEventListener("blur",blurListener);else{keyListener=el.getElementsByTagName("input").item(0),inputListener=el.getElementsByTagName("textarea").item(0);if(keyListener)keyListener.addEventListener("blur",blurListener);else{if(!inputListener)throw"v-number must apply to input type of tag";inputListener.addEventListener("blur",blurListener)}}},beforeUnmount:el=>{var inputElement,addedListeners=listeners.get(el);addedListeners&&(el.removeEventListener("keydown",addedListeners.key),el.removeEventListener("input",addedListeners.input),["INPUT","TEXTAREA"].includes(el.tagName)?el.removeEventListener("blur",addedListeners.blur):(inputElement=el.getElementsByTagName("input").item(0),el=el.getElementsByTagName("textarea").item(0),inputElement?.removeEventListener("blur",addedListeners.blur),el?.removeEventListener("blur",addedListeners.blur)))}})}}const validBinding=binding=>{if(binding.value?.min&&isNaN(Number(binding.value.min)))throw"v-number min value must be number";if(binding.value?.max&&isNaN(Number(binding.value.max)))throw"v-number max value must be number"},notNumber=/(?!^-)[^0-9]/g,notDecimal=/(?!^-)[^0-9.]/g,systemKey=["Delete","Backspace","Tab","Esc","Escape","Enter","Home","End","PageUp","PageDown","Del","Delete","Left","ArrowLeft","Right","ArrowRight","Insert","Up","ArrowUp","Down","ArrowDown"],keyWithCtrl=["a","A","c","C","x","X","v","V"],MAXIMUM_DECIMAL_LENGTH=10,DEFAULT_MIN_NUMBER=-1e19,DEFAULT_MAX_NUMBER=1e19,DECIMAL_SEPARATOR=".",THOUSAND_SEPARATOR=",",keyEvent=(e,binding)=>{var{key,ctrlKey,metaKey}=e,target=e.target,selectionStart=target.selectionStart||0;systemKey.includes(key)||(ctrlKey||metaKey)&&keyWithCtrl.includes(key)||(target&&0===selectionStart&&target.value.includes("-")?e.preventDefault():"0"<=key&&key<="9"||"-"===key&&binding.modifiers.minus&&target&&0===selectionStart&&!target.value.includes("-")||(key!==DECIMAL_SEPARATOR||!binding.modifiers.point||!target||target.value.includes(key)||target.value.includes("-")&&selectionStart<=1)&&e.preventDefault())},inputEvent=(e,binding)=>{e=e.target;process(e,binding),e.dispatchEvent(new Event("change",{bubbles:!0,cancelable:!1,composed:!0}))},process=(el,binding)=>{selections.set(el,el.selectionStart||0),processPoint(el,binding.modifiers.point),processMinus(el,binding.modifiers.minus),processMinMax(el,binding.value),processMoney(el,binding.modifiers.money),prevCommaCount.set(el,(el.value.match(/,/g)||[]).length)},processPoint=(el,point)=>{point?(el.value=el.value.replace(notDecimal,"").replace(/^(-?\d*\.?)|(\d*)\.?/g,"$1$2"),0===el.value.indexOf(DECIMAL_SEPARATOR)&&(el.value="0"+el.value,el.setSelectionRange(getSelectionStart(el)+1,getSelectionStart(el)+1)),el.value.includes(DECIMAL_SEPARATOR)&&el.value.substring(el.value.indexOf(DECIMAL_SEPARATOR)).length>MAXIMUM_DECIMAL_LENGTH&&(el.value=el.value.substring(0,el.value.indexOf(DECIMAL_SEPARATOR)+MAXIMUM_DECIMAL_LENGTH),el.setSelectionRange(getSelectionStart(el),getSelectionStart(el)))):el.value=el.value.replace(notNumber,"")},processMinus=(el,minus)=>{minus?(minus=0===el.value.indexOf("-"),el.value=el.value.replace(/-/g,""),minus&&(el.value="-"+el.value,el.setSelectionRange(getSelectionStart(el),getSelectionStart(el)))):el.value=el.value.replace(/-/g,"")},processMinMax=(el,bindingValue)=>{let min=bindingValue?.min??DEFAULT_MIN_NUMBER,max=bindingValue?.max??DEFAULT_MAX_NUMBER;min<DEFAULT_MIN_NUMBER&&(min=DEFAULT_MIN_NUMBER),max>DEFAULT_MAX_NUMBER&&(max=DEFAULT_MAX_NUMBER);bindingValue=Number(el.value);bindingValue<min&&(el.value=String(min)),bindingValue>max&&(el.value=String(max))},processMoney=(el,money)=>{money?([money,decimal]=el.value.split(DECIMAL_SEPARATOR),money=addSeparator(money.replace(/,/g,""),THOUSAND_SEPARATOR),el.value=joinAll(money,decimal,DECIMAL_SEPARATOR)):el.value=el.value.replace(/,/g,"");var decimal,money=(el.value.match(/,/g)||[]).length;getPrevCommaCount(el)+1===money?el.setSelectionRange(getSelectionStart(el)+1,getSelectionStart(el)+1):el.setSelectionRange(getSelectionStart(el),getSelectionStart(el))},blurEvent=(e,binding)=>{e=e.target;deleteFirstZero(e),deleteFirstSeparator(e),deleteLastZeroForDecimal(e),deleteLastDecimalPoint(e),deleteOnlyMinus(e),setDefaultValue(e,binding),process(e,binding),e.dispatchEvent(new Event("input",{bubbles:!0,cancelable:!1,composed:!0}))},deleteFirstSeparator=el=>{for(;el.value.startsWith(",");)el.value=el.value.substring(1);for(;el.value.startsWith("-,");)el.value=el.value.slice(0,1)+el.value.slice(2)},deleteFirstZero=el=>{for(;el.value.startsWith("-0")&&!el.value.startsWith("-0.");)el.value=el.value.slice(0,1)+el.value.slice(2),deleteFirstSeparator(el);for(;el.value.startsWith("0")&&!el.value.startsWith("0.");)el.value=el.value.substring(1),deleteFirstSeparator(el)},deleteLastZeroForDecimal=el=>{if(el.value.includes(DECIMAL_SEPARATOR))for(;el.value.endsWith("0");)el.value=el.value.slice(0,-1)},deleteLastDecimalPoint=el=>{el.value.endsWith(DECIMAL_SEPARATOR)&&(el.value=el.value.slice(0,-1))},deleteOnlyMinus=el=>{"-"===el.value&&(el.value="")},setDefaultValue=(el,binding)=>{el.value.trim()||(binding=binding.value?.min||0,el.value=0<binding?String(binding):"0")},getSelectionStart=el=>selections.get(el)||0,getPrevCommaCount=el=>prevCommaCount.get(el)||0,addSeparator=(integer,separator)=>integer.replace(/(\d)(?=(?:\d{3})+\b)/gm,"$1"+separator),joinAll=(integer,decimal,separator)=>decimal?integer+separator+decimal:integer;export default new VueNumber;